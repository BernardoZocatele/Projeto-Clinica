<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Logo Castelli</title>
  <link rel="stylesheet" href="main.css">
  <script type="text/javascript" src="/eel.js"></script> <!-- Sempre deve exporta esse script. Não precisa criar nada -->
</head>
<body>

  <div class="top-bar">
    <div class="logo">Castelli</div>
  </div>

  <h2>Bem-vindo, <span id="nome-usuario"></span>!</h2>
  <h2>Empresa Id: <span id="empresa-id"></span></h2>

  <div class="content">

    <div class="sugest">
        <h3 id="sugest_text">Sugestões de compras</h3>

        <div class="sugest_box">
            
        </div>
    </div>

    <div class="estoque">
        <h3 id="add_text">Adicionar produto ao estoque</h3>
        <div class="add_box">
            <input type="text" name="input_add_nome" id="nome" placeholder="Nome do Produto">
            <input type="text" name="input_add_qtd" id="qtd" placeholder="Quantidade">
            <input type="text" name="input_add_min"  id="minimo" placeholder="Mínimo">
            <input type="text" name="input_add_id"  id="id" placeholder="Id do Produto">
            <div>
                <button onclick="adicionar_item()" type="submit">Adicionar</button>
            </div>
        </div>
    </div>

    <div class="edit">
      <h3 id="edit_text">Editar estoque</h3>

      <div class="edit_box">
        <input type="text" name="input_edit_nome" placeholder="Nome do Produto / Id do Produto">
        <button type="submit">Procurar</button>

        <div class="infos_edit">


        </div>

        <input type="text" name="add_qtd" placeholder="Remover">
        <input type="text" name="remove_qtd" placeholder="Adicionar">
        <button type="submit">Concluir</button>

      </div>
    </div>

    <div class="estoque_consulta">
        <h3>Consultar estoque</h3>

        <div class="consult_box">
          <input type="text" id="item_consulta" placeholder="Id / Nome">
          <button onclick="consultar_item()" type="submit">Consultar item</button>
          <button type="submit" onclick="consultar_estoque()">Consultar todo o estoque</button>
        </div>

        <table border="1">
          <thead>
            <tr>
              <th>Item</th>
              <th>Quantidade</th>
              <th>Empresa ID</th>
            </tr>
          </thead>
        <tbody id="tabela-estoque">
          <!-- Aqui os dados serão inseridos -->
        </tbody>
</table>

    </div>
  </div>

  <script>
    const userInfos = JSON.parse(localStorage.getItem('userInfo'));
    if(userInfos) {
      document.getElementById("nome-usuario").textContent = userInfos.usuario
      document.getElementById("empresa-id").textContent = userInfos.empresa_id
    }

    function adicionar_item() {
      nome = document.getElementById("nome").value
      qtd = document.getElementById("qtd").value
      minimo = document.getElementById("minimo").value
      id = document.getElementById("id").value

      eel.inserir_item(userInfos.usuario, userInfos.empresa_id, nome, qtd, minimo, id)
    }

    function consultar_item() {
      nome = document.getElementById("item_consulta").value

      eel.consultar_estoque(userInfos.empresa_id, nome)
    }

    function consultar_estoque() {
      eel.consultar_estoque(userInfos.empresa_id, null)
    }

    function receber_estoque(estoque) {
      console.log(estoque)

      const tabela = document.getElementById("tabela-estoque");
      tabela.innerHTML = "";

      const linha = `
        <tr>
            <td>${estoque[0]}</td>
            <td>${estoque[1]}</td>
            <td>${estoque[2]}</td>
        </tr>
    `;

      tabela.innerHTML = linha;
    }

    eel.expose(receber_estoque);

    function receber_estoque_todo(estoque) {
      localStorage.setItem('estoque', JSON.stringify(estoque));
      window.location.href = 'estoque.html';
    }

    eel.expose(receber_estoque_todo);
  </script>

</body>
</html>